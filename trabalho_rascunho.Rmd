---
title: "R Notebook"
output: html_notebook
---
```{r}
library(magrittr) # quando der problema com o "%>%"
library('dplyr') # selecao e filtro de dados
library('geosphere') # localizacao geoespacial
library(lubridate) # datas, funções hour, month, wday
library(plotly) # plot dos gráficos
library(knitr) # usada pelo plotly
library(dummies)
library(scales)
source('preprocessing.R')
```


```{r}
train <- read.csv("train/train.csv")

# pega apenas as 10 primeiras linhas para teste
df <- head(train, 300)
```

Adiciona distância Euclidiana calculada a partir das coordenadas (arquivo Preprocessing.R)
```{r}

df$dist_euclidiana = dist_eucl(df)

```

Adiciona distância de Manhattan calculada a partir das coordenadas (arquivo Preprocessing.R)
```{r}

df$dist_manhattan = dist_manh(df)

```

Prepara data e hora da paprtida (acho que não precisa da chegada)
Com isso é possível pegar horário de pico e dia da semana

```{r}
df$pickup_hour <- hour(df$pickup_datetime)
df$pickup_month <- month(df$pickup_datetime)
df$pickup_weekdays <- wday(df$pickup_datetime)
```

Plotar correlação distancia tempo
```{r}
plot_ly(data= df, x= ~dist_euclidiana, y= ~trip_duration, type = 'scatter', mode = 'markers')
```

Plotar correlação distancia tempo manhatan
```{r}
plot_ly(data= df, x= ~dist_manhattan, y= ~trip_duration, type = 'scatter', mode = 'markers')
```

Média da duração das viagens por hora
```{r}
df %>%
  group_by(pickup_hour) %>%
  summarize(mean_trip_duration = mean(trip_duration),n()) -> data_plot
plot_ly(data= data_plot, x= ~pickup_hour, y= ~mean_trip_duration, type = 'bar')
```

Quantidade de viagens por hora
```{r}
df %>%
  group_by(pickup_hour) %>%
  count() -> data_plot
plot_ly(data= data_plot, x= ~pickup_hour, y= ~n, type = 'bar')
```

Limpeza de corridas zeradas
```{r}
df %>%
  filter(df$dist_manhattan > 0.5) -> df
```

Normalizar dados para a análise

Primeiro, criando variáveis dummies para dia da semana e hora
```{r}
week_dummy = dummy(df$pickup_weekdays, sep='_')
hour_dummy = dummy(df$pickup_hour, sep='_')

df = data.frame(cbind(df, week_dummy, hour_dummy))
```

Agora normalizando com Min Max Scaler as variáveis: distância, trip_duration e passenger_count
```{r}
df$dist_manhattan = rescale(df$dist_manhattan)
df$trip_duration = rescale(df$trip_duration)
df$passenger_count = rescale(df$trip_duration)

```

